From cc05fea6f274a464829ee683796e94625b51c800 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Kamil=20Trzci=C5=84ski?= <ayufan@ayufan.eu>
Date: Fri, 8 Jan 2021 00:19:23 +0100
Subject: [PATCH] ayufan: dw-mipi-dsi: fix `dw-mipi-dsi` to ensure that lane is
 properly configured (fix for display)

---
 drivers/gpu/drm/rockchip/dw-mipi-dsi-rockchip.c | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/drivers/gpu/drm/rockchip/dw-mipi-dsi-rockchip.c b/drivers/gpu/drm/rockchip/dw-mipi-dsi-rockchip.c
index 542dcf7eddd6..d569e890ce33 100644
--- a/drivers/gpu/drm/rockchip/dw-mipi-dsi-rockchip.c
+++ b/drivers/gpu/drm/rockchip/dw-mipi-dsi-rockchip.c
@@ -388,6 +388,14 @@ static int dw_mipi_dsi_phy_init(void *priv_data)
 	 */
 	vco = (dsi->lane_mbps < 200) ? 0 : (dsi->lane_mbps + 100) / 200;
 
+	if (dsi->cdata->lanecfg1_grf_reg) {
+		regmap_write(dsi->grf_regmap, dsi->cdata->lanecfg1_grf_reg,
+					      dsi->cdata->lanecfg1);
+
+	  dev_info(dsi->dev, "dw_mipi_dsi_phy_init / dw_mipi_dsi_rockchip_config: %08x => set=%08x\n",
+			dsi->cdata->lanecfg1_grf_reg, dsi->cdata->lanecfg1);
+	}
+
 	i = max_mbps_to_parameter(dsi->lane_mbps);
 	if (i < 0) {
 		DRM_DEV_ERROR(dsi->dev,
-- 
GitLab
From 25d2f7217fc9e4210066ddd7eeca5845011d9cd3 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Kamil=20Trzci=C5=84ski?= <ayufan@ayufan.eu>
Date: Wed, 13 Jan 2021 23:02:00 +0100
Subject: [PATCH] ayufan: st7703: fix display offset by not using sync pulse

---
 drivers/gpu/drm/panel/panel-sitronix-st7703.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/gpu/drm/panel/panel-sitronix-st7703.c b/drivers/gpu/drm/panel/panel-sitronix-st7703.c
index 65e8de28e8b7..92a301367fe4 100644
--- a/drivers/gpu/drm/panel/panel-sitronix-st7703.c
+++ b/drivers/gpu/drm/panel/panel-sitronix-st7703.c
@@ -351,7 +351,7 @@ static const struct drm_display_mode xbd599_mode = {
 static const struct st7703_panel_desc xbd599_desc = {
 	.mode = &xbd599_mode,
 	.lanes = 4,
-	.mode_flags = MIPI_DSI_MODE_VIDEO | MIPI_DSI_MODE_VIDEO_SYNC_PULSE,
+	.mode_flags = MIPI_DSI_MODE_VIDEO | MIPI_DSI_MODE_VIDEO_BURST,
 	.format = MIPI_DSI_FMT_RGB888,
 	.init_sequence = xbd599_init_sequence,
 };
-- 
GitLab
From 751eab3e0d3a08b84359e1587cad6167543efd4c Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Kamil=20Trzci=C5=84ski?= <ayufan@ayufan.eu>
Date: Wed, 13 Jan 2021 23:01:23 +0100
Subject: [PATCH] ayufan: st7703: increase reset pulse to reliably reset panel

---
 drivers/gpu/drm/panel/panel-sitronix-st7703.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/gpu/drm/panel/panel-sitronix-st7703.c b/drivers/gpu/drm/panel/panel-sitronix-st7703.c
index 8996ced2b721..65e8de28e8b7 100644
--- a/drivers/gpu/drm/panel/panel-sitronix-st7703.c
+++ b/drivers/gpu/drm/panel/panel-sitronix-st7703.c
@@ -446,7 +446,7 @@ static int st7703_prepare(struct drm_panel *panel)
 	}
 
 	gpiod_set_value_cansleep(ctx->reset_gpio, 1);
-	usleep_range(20, 40);
+	mdelay(1);
 	gpiod_set_value_cansleep(ctx->reset_gpio, 0);
 	msleep(20);
 
-- 
GitLab


